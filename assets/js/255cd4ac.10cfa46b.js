"use strict";(self.webpackChunkerlendthune_com=self.webpackChunkerlendthune_com||[]).push([[1572],{709:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"treasurehunter/treasure-hunt","title":"Treasure Hunt","description":"Open the standalone QR scanner page do perform the treasure hunt.","source":"@site/docs/treasurehunter/treasure-hunt.mdx","sourceDirName":"treasurehunter","slug":"/treasurehunter/treasure-hunt","permalink":"/docs/treasurehunter/treasure-hunt","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Treasure Hunt","hide_title":true},"sidebar":"productsSidebar","previous":{"title":"Create Treasure Hunt","permalink":"/docs/treasurehunter/create-treasure-hunt"},"next":{"title":"Garmin wizard","permalink":"/docs/category/garmin-wizard"}}');var o=n(4848),s=n(8453),a=n(129);const i={sidebar_position:3,title:"Treasure Hunt",hide_title:!0},d=void 0,l={},c=[];function u(e){const t={a:"a",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Open the ",(0,o.jsx)(t.a,{href:"/qr-scanner",children:"standalone QR scanner page"})," do perform the treasure hunt."]}),"\n",(0,o.jsx)(t.p,{children:"You can also test it below:"}),"\n",(0,o.jsx)(a.A,{showScannedCode:!0})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},2921:(e,t,n)=>{n.d(t,{J$:()=>o,N7:()=>c,Pr:()=>i,UD:()=>r,Wp:()=>a,hP:()=>d,wU:()=>s,xP:()=>u,zj:()=>l});const r=e=>{const t=e.export(),n=function(e){let t,n=0,r=e.length,o="";for(;n<r;)t=e.subarray(n,Math.min(n+32768,r)),o+=String.fromCharCode.apply(null,t),n+=32768;return btoa(o)}(new Uint8Array(t));localStorage.setItem("sqlite-db",n),console.log("Database saved to localStorage")};const o=(e,t,n)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout((()=>{t&&(console.log("Retrying image load with available database"),o(e,t,n))}),100),null;try{const r=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode = ?");if(r.bind([e.toString()]),r.step()){const t=r.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),n&&n(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),n&&n(null),null}catch(r){return console.error("Error loading image:",r),n&&n("ERROR"),"ERROR"}},s=async(e,t,n,r)=>{try{console.log("Loading database...");const s={locateFile:()=>"/sql/sql-wasm.wasm"};await(o="/sql/sql-wasm.js",new Promise(((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=o,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)})));const a=await window.initSqlJs(s),i=localStorage.getItem("sqlite-db");let d;if(i){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(i).split("").map((e=>e.charCodeAt(0))));d=new a.Database(e)}else console.log("No saved database found, creating new one"),d=new a.Database,d.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);");e(d),((e,t,n,r)=>{try{console.log("Initializing treasure sequence...");const o=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),s=[];for(;o.step();){const e=o.getAsObject();s.push(e.qrkode)}o.free(),console.log("Found treasure sequence:",s),t(s),s.length>0?(console.log("Loading first image for step 1"),r(1,e)):(console.log("No treasures found in database"),n("NO_DATA"))}catch(o){console.error("Error initializing sequence:",o),n("ERROR")}})(d,n,t,r)}catch(s){console.error("Error loading database:",s),t("ERROR")}var o},a=(e,t,n)=>{const r=e.exec("SELECT * FROM steg"),o=r[0]?r[0].values:[];if(t(o),0===o.length)n(1);else{const e=o.map((e=>{let[t]=e;return parseInt(t)})).filter((e=>!isNaN(e)));n(e.length>0?Math.max(...e)+1:1)}},i=(e,t,n)=>"random"===e?t:n,d=(e,t,n,r,s,a,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:h,setGameComplete:g,setCurrentImage:f}=l,m=i(n,r,s),p=m.slice(0,-1),b=p.includes(e),x=a.includes(e);if(b&&!x){u((t=>[...t,e]));const t=p.filter((t=>!a.includes(t)&&t!==e));if(0===t.length){const t=s[s.length-1];o(t,d,f),h(m.length),g(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`)}else{const n=t[0];o(n,d,f),h(a.length+1),1===t.length?c(`${e} found! Find the last location (QR ${n})`):c(`${e} found! Find any of the ${t.length} remaining locations`)}}else x?c(`Already found: QR ${e} was already scanned`):s.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")},l=(e,t,n,r)=>{const{setGameStarted:s,setCurrentStep:a,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=r;if(0!==t.length)if(s(!0),a(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(t.slice(0,-1));c([...e,t[t.length-1]]),o(e[0],n,u)}else c(t),o(t[0],n,u)},c=(e,t,n,o,s)=>{try{const i=e.prepare("DELETE FROM steg WHERE qrkode = ?");i.bind([t]),i.step(),i.free(),r(e),a(e,o,s),n(`Item with QR code ${t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),n("Error deleting item from database.")}},u=(e,t,n,o,s,i,d)=>{try{if(t===n||t<0||n<0||t>=o.length||n>=o.length)return;const l=[...o],[c]=l.splice(t,1);l.splice(n,0,c),e.run("DELETE FROM steg"),l.forEach((t=>{let[n,r]=t;const o=e.prepare("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)");o.bind([n,r]),o.step(),o.free()})),r(e),a(e,i,d);const u=t<n?"down":"up";s(`Moved item with QR code ${c[0]} ${u} to position ${n+1}`)}catch(l){console.error("Error reordering database items:",l),s("Error reordering items in database.")}}},129:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(6540),o=n(4848);const s=e=>{let{huntMode:t,setHuntMode:n,onStartGame:r,treasureCount:s}=e;return(0,o.jsxs)("div",{style:{marginBottom:20,padding:20,background:"#f8f9fa",borderRadius:8},children:[(0,o.jsx)("h3",{style:{textAlign:"center",marginBottom:15},children:"Choose Hunt Mode"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[(0,o.jsxs)("div",{style:{padding:15,border:"sequential"===t?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"sequential"===t?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>n("sequential"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"sequential"===t?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Sequential Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Follow the hunt in order (1, 2, 3...). Perfect for guided tours or specific paths."})]}),(0,o.jsxs)("div",{style:{padding:15,border:"random"===t?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"random"===t?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>n("random"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"random"===t?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Random Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Find locations in any order. Great for exploration and flexibility."})]})]}),(0,o.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,o.jsxs)("button",{onClick:r,style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#007bff",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:"1em",boxShadow:"0 2px 8px rgba(0, 123, 255, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="#0056b3",onMouseOut:e=>e.target.style.background="#007bff",children:["Start ","sequential"===t?"Sequential":"Random"," Hunt \ud83d\uddfa\ufe0f"]})}),(0,o.jsxs)("div",{style:{textAlign:"center",marginTop:15,fontSize:"0.8em",color:"#666"},children:["Found ",s," locations in database",s>1&&(0,o.jsxs)("span",{children:[" \u2022 ",s-1," QR codes + 1 treasure location"]})]})]})},a=e=>{let{gameStarted:t,gameComplete:n,scannedCodes:r,treasureSequence:s,huntMode:a,getCurrentSequence:i}=e;return t?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:10},children:n?`Treasure Hunt Complete! Found ${r.length} locations + treasure`:`Progress: ${r.length} of ${s.length-1} locations found`}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:5},children:i().map(((e,t)=>(0,o.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:t<r.length?"#4caf50":t!==r.length||n?t===i().length-1&&n?"#ffd700":"#e0e0e0":"#2196f3"},title:t===i().length-1?"Treasure location":`Location ${t+1}`},t)))}),n&&(0,o.jsx)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:"\ud83c\udfc6 = Treasure location (no QR code here)"}),(0,o.jsxs)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:["Mode: ","sequential"===a?"Sequential":"Random"," Hunt"]})]}):null},i=e=>{let{currentImage:t,currentStep:n,gameComplete:r,scannedCodes:s,onStartNewHunt:a}=e;return"NO_DATA"===t?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#fff3cd",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"No Treasure Hunt Data Found"}),(0,o.jsx)("p",{children:"Please use the Treasure Hunt Maker to create some QR codes and images first."}),(0,o.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:"Go to the maker page, scan QR codes, take snapshots, and save them to the database."})]}):"ERROR"===t?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#f8d7da",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"Error Loading Treasure Hunt"}),(0,o.jsx)("p",{children:"There was an error loading the treasure hunt data."}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#dc3545",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:10},children:"Retry"})]}):t&&0!==t.length?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("h3",{style:{marginBottom:10},children:r?"\ud83c\udf89 Treasure Found! \ud83c\udf89":0===s.length?"Find this location to start!":`Find location ${n}`}),(0,o.jsx)("img",{src:t,alt:`Location ${n}`,style:{maxWidth:"100%",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,o.jsx)("div",{style:{marginTop:10,fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:r?"\ud83c\udfc6 This is where the treasure is hidden! No QR code to scan here.":"When you find this location, scan the QR code there to proceed."}),r&&(0,o.jsx)("button",{onClick:a,style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:15,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.3)"},children:"Start New Hunt"})]}):(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:"#e3f2fd",borderRadius:8,textAlign:"center"},children:(0,o.jsx)("strong",{children:"Loading treasure hunt..."})})};var d=n(6624),l=n.n(d);const c=e=>{let{onQRCodeScanned:t,width:n=320,height:s=240,style:a={}}=e;const i=(0,r.useRef)(null),d=(0,r.useRef)(null);return(0,r.useEffect)((()=>{let e,n=null,r=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!r)return void o.getTracks().forEach((e=>e.stop()));if(n=o,i.current){i.current.srcObject=o,i.current.setAttribute("playsinline",!0),i.current.setAttribute("muted",!0);const n=async()=>{try{if(await i.current.play(),r&&i.current&&!i.current.paused){const n=()=>{if(r&&i.current&&!i.current.paused){if(i.current&&d.current){const e=d.current.getContext("2d");e.drawImage(i.current,0,0,d.current.width,d.current.height);const n=e.getImageData(0,0,d.current.width,d.current.height),r=l()(n.data,n.width,n.height);r&&r.data&&t(r.data)}r&&(e=setTimeout((()=>{r&&i.current&&!i.current.paused&&n()}),200))}};n()}}catch(n){"AbortError"!==n.name&&console.warn("Video play error:",n)}};i.current.readyState>=1?n():i.current.addEventListener("loadedmetadata",n,{once:!0})}}catch(o){console.error("Error accessing camera:",o)}})(),()=>{if(r=!1,e&&clearTimeout(e),i.current&&(i.current.pause(),i.current.srcObject)){i.current.srcObject.getTracks().forEach((e=>e.stop())),i.current.srcObject=null}n&&n.getTracks().forEach((e=>e.stop()))}}),[t]),(0,o.jsxs)("div",{style:a,children:[(0,o.jsx)("video",{ref:i,style:{width:n,height:s,...a.video}}),(0,o.jsx)("canvas",{ref:d,width:n,height:s,style:{display:"none"}})]})},u=e=>{let{gameComplete:t,lastScannedCode:n,handleQRCodeScanned:r,scannedCodes:s,currentStep:a,showScannedCode:i,onDismissMessage:d}=e;if(t)return null;const l=n&&(n.includes("Wrong sequence")||n.includes("Already used")||n.includes("Already found")||n.includes("Already scanned")||n.includes("Not part of this hunt")||n.includes("This QR code is part of the treasure hunt but not a location to find"));return(0,o.jsxs)(o.Fragment,{children:[n&&(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:l?"#ffebee":"#e8f5e8",borderRadius:8,border:l?"1px solid #f44336":"1px solid #4caf50",position:"relative"},children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[(0,o.jsxs)("span",{style:{color:l?"#d32f2f":"#2e7d32",fontWeight:500,flex:1},children:[l?"\u26a0\ufe0f":"\u2705"," ",n.replace(/^Wrong sequence: |^Already used: |^Already scanned: |^Not part of this hunt: /,"")]}),l&&d&&(0,o.jsx)("button",{onClick:d,style:{background:"none",border:"none",color:"#d32f2f",fontSize:"18px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"30px",height:"30px"},title:"Dismiss message",children:"\u2715"})]})}),(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("h4",{style:{marginBottom:10},children:"QR Code Scanner"}),(0,o.jsx)(c,{onQRCodeScanned:r,width:320,height:240}),i&&n&&!l&&(0,o.jsxs)("div",{style:{marginTop:5,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["Last scanned: ",n]})]})]})};var h=n(2921);const g=e=>{let{showScannedCode:t=!1}=e;const[n,d]=(0,r.useState)(null),[l,c]=(0,r.useState)(1),[g,f]=(0,r.useState)(null),[m,p]=(0,r.useState)([]),[b,x]=(0,r.useState)([]),[y,S]=(0,r.useState)(!1),[R,C]=(0,r.useState)(""),[j,v]=(0,r.useState)("sequential"),[w,E]=(0,r.useState)(!1),[T,k]=(0,r.useState)([]);(0,r.useEffect)((()=>{(0,h.wU)(d,f,x,((e,t)=>{(0,h.J$)(e,t,f)}))}),[]);return(0,o.jsxs)("div",{style:{maxWidth:500,margin:"0px auto",padding:20,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,o.jsx)("h2",{style:{textAlign:"center",marginBottom:20},children:"Treasure Hunt"}),!w&&b.length>0&&"NO_DATA"!==g&&"ERROR"!==g&&(0,o.jsx)(s,{huntMode:j,setHuntMode:v,onStartGame:()=>{const e={setGameStarted:E,setCurrentStep:c,setScannedCodes:p,setLastScannedCode:C,setGameComplete:S,setShuffledSequence:k,setCurrentImage:f};(0,h.zj)(j,b,n,e)},treasureCount:b.length}),(0,o.jsx)(a,{gameStarted:w,gameComplete:y,scannedCodes:m,treasureSequence:b,huntMode:j,getCurrentSequence:()=>(0,h.Pr)(j,T,b)}),w&&(0,o.jsx)(i,{currentImage:g,currentStep:l,gameComplete:y,scannedCodes:m,onStartNewHunt:()=>{window.location.reload()}}),w&&(0,o.jsx)(u,{gameComplete:y,lastScannedCode:R,handleQRCodeScanned:e=>{const t={setLastScannedCode:C,setScannedCodes:p,setCurrentStep:c,setGameComplete:S,setCurrentImage:f};(0,h.hP)(e,l,j,T,b,m,n,t)},scannedCodes:m,currentStep:l,showScannedCode:t,onDismissMessage:()=>{C("")}})]})}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var r=n(6540);const o={},s=r.createContext(o);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);