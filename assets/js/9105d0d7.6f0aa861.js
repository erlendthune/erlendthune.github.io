"use strict";(self.webpackChunkerlendthune_com=self.webpackChunkerlendthune_com||[]).push([[7975],{2921:(e,t,n)=>{n.d(t,{J$:()=>o,N7:()=>c,Pr:()=>i,UD:()=>r,Wp:()=>s,hP:()=>d,wU:()=>a,xP:()=>u,zj:()=>l});const r=e=>{const t=e.export(),n=function(e){let t,n=0,r=e.length,o="";for(;n<r;)t=e.subarray(n,Math.min(n+32768,r)),o+=String.fromCharCode.apply(null,t),n+=32768;return btoa(o)}(new Uint8Array(t));localStorage.setItem("sqlite-db",n),console.log("Database saved to localStorage")};const o=(e,t,n)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout((()=>{t&&(console.log("Retrying image load with available database"),o(e,t,n))}),100),null;try{const r=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode = ?");if(r.bind([e.toString()]),r.step()){const t=r.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),n&&n(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),n&&n(null),null}catch(r){return console.error("Error loading image:",r),n&&n("ERROR"),"ERROR"}},a=async(e,t,n,r)=>{try{console.log("Loading database...");const a={locateFile:()=>"/sql/sql-wasm.wasm"};await(o="/sql/sql-wasm.js",new Promise(((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=o,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)})));const s=await window.initSqlJs(a),i=localStorage.getItem("sqlite-db");let d;if(i){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(i).split("").map((e=>e.charCodeAt(0))));d=new s.Database(e)}else console.log("No saved database found, creating new one"),d=new s.Database,d.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);");e(d),((e,t,n,r)=>{try{console.log("Initializing treasure sequence...");const o=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),a=[];for(;o.step();){const e=o.getAsObject();a.push(e.qrkode)}o.free(),console.log("Found treasure sequence:",a),t(a),a.length>0?(console.log("Loading first image for step 1"),r(1,e)):(console.log("No treasures found in database"),n("NO_DATA"))}catch(o){console.error("Error initializing sequence:",o),n("ERROR")}})(d,n,t,r)}catch(a){console.error("Error loading database:",a),t("ERROR")}var o},s=(e,t,n)=>{const r=e.exec("SELECT * FROM steg"),o=r[0]?r[0].values:[];if(t(o),0===o.length)n(1);else{const e=o.map((e=>{let[t]=e;return parseInt(t)})).filter((e=>!isNaN(e)));n(e.length>0?Math.max(...e)+1:1)}},i=(e,t,n)=>"random"===e?t:n,d=(e,t,n,r,a,s,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:g,setGameComplete:h,setCurrentImage:m}=l,f=i(n,r,a),p=((e,t,n,r)=>{const o=i(e,t,n);return 0===o.length||r>o.length?null:o[r-1]})(n,r,a,t);if(e===p&&!s.includes(e))if(c(e),u((t=>[...t,e])),t>=f.length-1){const e=a[a.length-1];o(e,d,m),g(f.length),h(!0)}else{const e=t+1,n=f[e-1];o(n,d,m),g(e)}},l=(e,t,n,r)=>{const{setGameStarted:a,setCurrentStep:s,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=r;if(0!==t.length)if(a(!0),s(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(t.slice(0,-1));c([...e,t[t.length-1]]),o(e[0],n,u)}else c(t),o(t[0],n,u)},c=(e,t,n,o,a)=>{try{const i=e.prepare("DELETE FROM steg WHERE qrkode = ?");i.bind([t]),i.step(),i.free(),r(e),s(e,o,a),n(`Item with QR code ${t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),n("Error deleting item from database.")}},u=(e,t,n,o,a,i,d)=>{try{if(t===n||t<0||n<0||t>=o.length||n>=o.length)return;const l=[...o],[c]=l.splice(t,1);l.splice(n,0,c),e.run("DELETE FROM steg"),l.forEach((t=>{let[n,r]=t;const o=e.prepare("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)");o.bind([n,r]),o.step(),o.free()})),r(e),s(e,i,d);const u=t<n?"down":"up";a(`Moved item with QR code ${c[0]} ${u} to position ${n+1}`)}catch(l){console.error("Error reordering database items:",l),a("Error reordering items in database.")}}},129:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(6540),o=n(4848);const a=e=>{let{huntMode:t,setHuntMode:n,onStartGame:r,treasureCount:a}=e;return(0,o.jsxs)("div",{style:{marginBottom:20,padding:20,background:"#f8f9fa",borderRadius:8},children:[(0,o.jsx)("h3",{style:{textAlign:"center",marginBottom:15},children:"Choose Hunt Mode"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[(0,o.jsxs)("div",{style:{padding:15,border:"sequential"===t?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"sequential"===t?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>n("sequential"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"sequential"===t?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Sequential Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Follow the hunt in order (1, 2, 3...). Perfect for guided tours or specific paths."})]}),(0,o.jsxs)("div",{style:{padding:15,border:"random"===t?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"random"===t?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>n("random"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"random"===t?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Random Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Find locations in any order. Great for exploration and flexibility."})]})]}),(0,o.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,o.jsxs)("button",{onClick:r,style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#007bff",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:"1em",boxShadow:"0 2px 8px rgba(0, 123, 255, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="#0056b3",onMouseOut:e=>e.target.style.background="#007bff",children:["Start ","sequential"===t?"Sequential":"Random"," Hunt \ud83d\uddfa\ufe0f"]})}),(0,o.jsxs)("div",{style:{textAlign:"center",marginTop:15,fontSize:"0.8em",color:"#666"},children:["Found ",a," locations in database",a>1&&(0,o.jsxs)("span",{children:[" \u2022 ",a-1," QR codes + 1 treasure location"]})]})]})},s=e=>{let{gameStarted:t,gameComplete:n,scannedCodes:r,treasureSequence:a,huntMode:s,getCurrentSequence:i}=e;return t?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:10},children:n?`Treasure Hunt Complete! Found ${r.length} locations + treasure`:`Progress: ${r.length} of ${a.length-1} locations found`}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:5},children:i().map(((e,t)=>(0,o.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:t<r.length?"#4caf50":t!==r.length||n?t===i().length-1&&n?"#ffd700":"#e0e0e0":"#2196f3"},title:t===i().length-1?"Treasure location":`Location ${t+1}`},t)))}),n&&(0,o.jsx)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:"\ud83c\udfc6 = Treasure location (no QR code here)"}),(0,o.jsxs)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:["Mode: ","sequential"===s?"Sequential":"Random"," Hunt"]})]}):null},i=e=>{let{currentImage:t,currentStep:n,gameComplete:r,scannedCodes:a,onStartNewHunt:s}=e;return"NO_DATA"===t?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#fff3cd",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"No Treasure Hunt Data Found"}),(0,o.jsx)("p",{children:"Please use the Treasure Hunt Maker to create some QR codes and images first."}),(0,o.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:"Go to the maker page, scan QR codes, take snapshots, and save them to the database."})]}):"ERROR"===t?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#f8d7da",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"Error Loading Treasure Hunt"}),(0,o.jsx)("p",{children:"There was an error loading the treasure hunt data."}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#dc3545",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:10},children:"Retry"})]}):t&&0!==t.length?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("h3",{style:{marginBottom:10},children:r?"\ud83c\udf89 Treasure Found! \ud83c\udf89":0===a.length?"Find this location to start!":`Find location ${n}`}),(0,o.jsx)("img",{src:t,alt:`Location ${n}`,style:{maxWidth:"100%",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,o.jsx)("div",{style:{marginTop:10,fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:r?"\ud83c\udfc6 This is where the treasure is hidden! No QR code to scan here.":"When you find this location, scan the QR code there to proceed."}),r&&(0,o.jsx)("button",{onClick:s,style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:15,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.3)"},children:"Start New Hunt"})]}):(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:"#e3f2fd",borderRadius:8,textAlign:"center"},children:(0,o.jsx)("strong",{children:"Loading treasure hunt..."})})};var d=n(6624),l=n.n(d);const c=e=>{let{onQRCodeScanned:t,width:n=320,height:a=240,style:s={}}=e;const i=(0,r.useRef)(null),d=(0,r.useRef)(null);return(0,r.useEffect)((()=>{let e,n=null,r=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!r)return void o.getTracks().forEach((e=>e.stop()));if(n=o,i.current){i.current.srcObject=o,i.current.setAttribute("playsinline",!0),i.current.setAttribute("muted",!0);const n=async()=>{try{if(await i.current.play(),r&&i.current&&!i.current.paused){const n=()=>{if(r&&i.current&&!i.current.paused){if(i.current&&d.current){const e=d.current.getContext("2d");e.drawImage(i.current,0,0,d.current.width,d.current.height);const n=e.getImageData(0,0,d.current.width,d.current.height),r=l()(n.data,n.width,n.height);r&&r.data&&t(r.data)}r&&(e=setTimeout((()=>{r&&i.current&&!i.current.paused&&n()}),200))}};n()}}catch(n){"AbortError"!==n.name&&console.warn("Video play error:",n)}};i.current.readyState>=1?n():i.current.addEventListener("loadedmetadata",n,{once:!0})}}catch(o){console.error("Error accessing camera:",o)}})(),()=>{if(r=!1,e&&clearTimeout(e),i.current&&(i.current.pause(),i.current.srcObject)){i.current.srcObject.getTracks().forEach((e=>e.stop())),i.current.srcObject=null}n&&n.getTracks().forEach((e=>e.stop()))}}),[t]),(0,o.jsxs)("div",{style:s,children:[(0,o.jsx)("video",{ref:i,style:{width:n,height:a,...s.video}}),(0,o.jsx)("canvas",{ref:d,width:n,height:a,style:{display:"none"}})]})},u=e=>{let{gameComplete:t,lastScannedCode:n,handleQRCodeScanned:r,scannedCodes:a,currentStep:s,showScannedCode:i}=e;return t?null:(0,o.jsxs)(o.Fragment,{children:[n&&(0,o.jsxs)("div",{style:{marginBottom:20,padding:10,background:"#e8f5e8",borderRadius:8,textAlign:"center"},children:["\u2705 Found location ",n,"!"]}),(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("h4",{style:{marginBottom:10},children:"QR Code Scanner"}),(0,o.jsx)(c,{onQRCodeScanned:r,width:320,height:240}),i&&n&&(0,o.jsxs)("div",{style:{marginTop:5,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["Last scanned: ",n]})]})]})};var g=n(2921);const h=e=>{let{showScannedCode:t=!1}=e;const[n,d]=(0,r.useState)(null),[l,c]=(0,r.useState)(1),[h,m]=(0,r.useState)(null),[f,p]=(0,r.useState)([]),[b,x]=(0,r.useState)([]),[S,y]=(0,r.useState)(!1),[C,R]=(0,r.useState)(""),[j,v]=(0,r.useState)("sequential"),[w,E]=(0,r.useState)(!1),[T,k]=(0,r.useState)([]);(0,r.useEffect)((()=>{(0,g.wU)(d,m,x,((e,t)=>{(0,g.J$)(e,t,m)}))}),[]);return(0,o.jsxs)("div",{style:{maxWidth:500,margin:"0px auto",padding:20,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,o.jsx)("h2",{style:{textAlign:"center",marginBottom:20},children:"Treasure Hunt"}),!w&&b.length>0&&"NO_DATA"!==h&&"ERROR"!==h&&(0,o.jsx)(a,{huntMode:j,setHuntMode:v,onStartGame:()=>{const e={setGameStarted:E,setCurrentStep:c,setScannedCodes:p,setLastScannedCode:R,setGameComplete:y,setShuffledSequence:k,setCurrentImage:m};(0,g.zj)(j,b,n,e)},treasureCount:b.length}),(0,o.jsx)(s,{gameStarted:w,gameComplete:S,scannedCodes:f,treasureSequence:b,huntMode:j,getCurrentSequence:()=>(0,g.Pr)(j,T,b)}),w&&(0,o.jsx)(i,{currentImage:h,currentStep:l,gameComplete:S,scannedCodes:f,onStartNewHunt:()=>{window.location.reload()}}),w&&(0,o.jsx)(u,{gameComplete:S,lastScannedCode:C,handleQRCodeScanned:e=>{const t={setLastScannedCode:R,setScannedCodes:p,setCurrentStep:c,setGameComplete:y,setCurrentImage:m};(0,g.hP)(e,l,j,T,b,f,n,t)},scannedCodes:f,currentStep:l,showScannedCode:t})]})}},5639:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});n(6540);var r=n(129),o=n(4848);function a(){return(0,o.jsx)(r.A,{})}}}]);