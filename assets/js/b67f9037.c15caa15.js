"use strict";(self.webpackChunkerlendthune_com=self.webpackChunkerlendthune_com||[]).push([[4573],{7203:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>S,contentTitle:()=>x,default:()=>y,frontMatter:()=>f,metadata:()=>r,toc:()=>w});const r=JSON.parse('{"id":"treasurehunter/create-treasure-hunt","title":"Create Treasure Hunt","description":"","source":"@site/docs/treasurehunter/create-treasure-hunt.mdx","sourceDirName":"treasurehunter","slug":"/treasurehunter/create-treasure-hunt","permalink":"/docs/treasurehunter/create-treasure-hunt","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Create Treasure Hunt","hide_title":true},"sidebar":"productsSidebar","previous":{"title":"Instructions","permalink":"/docs/treasurehunter/instructions"},"next":{"title":"Treasure Hunt","permalink":"/docs/treasurehunter/treasure-hunt"}}');var a=n(4848),o=n(8453),s=n(6540),i=n(6624),d=n.n(i);const l=(0,s.forwardRef)(((e,t)=>{let{onQRCodeScanned:n,width:r=320,height:o=240,style:i={}}=e;const l=(0,s.useRef)(null),c=(0,s.useRef)(null);return(0,s.useImperativeHandle)(t,(()=>({takeSnapshot:()=>{if(l.current&&c.current){return c.current.getContext("2d").drawImage(l.current,0,0,c.current.width,c.current.height),c.current.toDataURL("image/jpeg",.8)}return null}}))),(0,s.useEffect)((()=>{let e,t=null,r=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!r)return void a.getTracks().forEach((e=>e.stop()));if(t=a,l.current){l.current.srcObject=a,l.current.setAttribute("playsinline",!0),l.current.setAttribute("muted",!0);const t=async()=>{try{if(await l.current.play(),r&&l.current&&!l.current.paused){const t=()=>{if(r&&l.current&&!l.current.paused){if(l.current&&c.current){const e=c.current.getContext("2d");e.drawImage(l.current,0,0,c.current.width,c.current.height);const t=e.getImageData(0,0,c.current.width,c.current.height),r=d()(t.data,t.width,t.height);r&&r.data&&n&&n(r.data)}r&&(e=setTimeout((()=>{r&&l.current&&!l.current.paused&&t()}),200))}};t()}}catch(t){"AbortError"!==t.name&&console.warn("Video play error:",t)}};l.current.readyState>=1?t():l.current.addEventListener("loadedmetadata",t,{once:!0})}}catch(a){console.error("Error accessing camera:",a)}})(),()=>{if(r=!1,e&&clearTimeout(e),l.current&&(l.current.pause(),l.current.srcObject)){l.current.srcObject.getTracks().forEach((e=>e.stop())),l.current.srcObject=null}t&&t.getTracks().forEach((e=>e.stop()))}}),[n]),(0,a.jsxs)("div",{style:i,children:[(0,a.jsx)("video",{ref:l,style:{width:r,height:o,...i.video}}),(0,a.jsx)("canvas",{ref:c,width:r,height:o,style:{display:"none"}})]})}));l.displayName="QRScannerWithSnapshot";const c=l,u=e=>{let{showScanner:t,setShowScanner:n,qrCode:r,setQrCode:o,setSnapshot:i,setImage:d,setMessage:l}=e;const u=(0,s.useRef)(null);return(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:500,marginBottom:6},children:"QR-code scanner:"}),t?(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{ref:u,onQRCodeScanned:e=>{o(e),l(`QR code scanned: ${e}`)},width:320,height:240}),(0,a.jsxs)("div",{style:{marginTop:10},children:[(0,a.jsx)("button",{onClick:()=>{if(u.current){const e=u.current.takeSnapshot();e&&(i(e),d(e),l("Snapshot taken! You can now save the QR code and image."))}},style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",marginRight:8,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.08)",transition:"background 0.2s"},children:"Take Snapshot"}),(0,a.jsx)("button",{onClick:()=>n(!1),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#757575",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(117, 117, 117, 0.08)",transition:"background 0.2s"},children:"Stop Scanner"})]})]}):(0,a.jsx)("button",{onClick:()=>n(!0),style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#1976d2",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:"pointer",marginRight:12,boxShadow:"0 1px 4px rgba(25, 118, 210, 0.08)",transition:"background 0.2s"},children:"Start QR Scanner"}),r&&(0,a.jsxs)("div",{style:{marginTop:10,padding:10,background:"#f5f5f5",borderRadius:6},children:[(0,a.jsx)("strong",{children:"Scanned QR Code:"})," ",r]})]})},h=e=>{let{snapshot:t,setSnapshot:n,image:r,setImage:o,qrCode:s,nextQRNumber:i,handleSave:d,handleSaveFinalTreasure:l}=e;return(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("div",{style:{padding:10,background:"#e8f5e8",borderRadius:6,marginBottom:10},children:(0,a.jsx)("strong",{children:"\u2713 Snapshot taken from camera"})}),(0,a.jsx)("button",{onClick:()=>{n(null),o(null)},style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#ff9800",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(255, 152, 0, 0.08)",transition:"background 0.2s"},children:"Clear Snapshot"})]}),r&&(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("h3",{style:{marginBottom:8},children:"Preview of snapshot:"}),(0,a.jsx)("img",{src:r,alt:"Preview",width:"200",style:{borderRadius:8,boxShadow:"0 1px 6px rgba(0,0,0,0.08)"}})]}),(0,a.jsxs)("div",{style:{marginBottom:24},children:[(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("h4",{style:{marginBottom:10},children:"Save Options:"}),(0,a.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:15},children:"Choose how to save this location:"})]}),(0,a.jsxs)("button",{onClick:d,disabled:!s||!r,style:{padding:"10px 20px",borderRadius:6,border:"none",background:s&&r?"#1976d2":"#ccc",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:s&&r?"pointer":"not-allowed",marginRight:12,marginBottom:8,boxShadow:"0 1px 4px rgba(25, 118, 210, 0.08)",transition:"background 0.2s"},title:s?r?"Save as regular hunt location":"Take a snapshot first":"Scan a QR code first",children:["Save as Hunt Location ",s?`(QR: ${s})`:""]}),(0,a.jsx)("br",{}),(0,a.jsxs)("button",{onClick:l,disabled:!r,style:{padding:"10px 20px",borderRadius:6,border:"none",background:r?"#ff9800":"#ccc",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:r?"pointer":"not-allowed",boxShadow:"0 1px 4px rgba(255, 152, 0, 0.08)",transition:"background 0.2s"},title:r?"Save as final treasure location (no QR code needed)":"Take a snapshot first",children:["Save as Final Treasure (#",i,")"]}),(0,a.jsxs)("div",{style:{marginTop:10,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["\ud83d\udca1 ",(0,a.jsx)("strong",{children:"Tip:"})," Save hunt locations first (with QR codes), then save the final treasure location last (no QR code)."]})]})]})};var g=n(2921);const b=e=>{let{databaseContent:t,db:n,setDb:r,setMessage:o,setDatabaseContent:s,setQrCode:i,setImage:d,setSnapshot:l,setShowScanner:c,setNextQRNumber:u}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{children:"Image database:"}),(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Actions"}),(0,a.jsx)("th",{children:"QR-code"}),(0,a.jsx)("th",{children:"Image (Base64)"}),(0,a.jsx)("th",{children:"Order"})]})}),(0,a.jsx)("tbody",{children:0===t.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"4",children:"The database is empty"})}):t.map(((e,r)=>{let[i,d]=e;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{style:{textAlign:"center"},children:(0,a.jsx)("button",{onClick:()=>(e=>{n?window.confirm(`Are you sure you want to delete the item with QR code ${e}?`)&&(0,g.N7)(n,e,o,s,u):o("Database not available")})(i),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#e74c3c",color:"#fff",fontWeight:600,fontSize:"0.875rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(231, 76, 60, 0.08)",transition:"background 0.2s"},children:"Delete"})}),(0,a.jsx)("td",{children:i}),(0,a.jsx)("td",{children:(0,a.jsx)("img",{src:d,alt:`Bilde ${i}`,width:"50"})}),(0,a.jsx)("td",{style:{textAlign:"center",padding:"8px"},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[(0,a.jsx)("button",{onClick:()=>(e=>{e>0&&(0,g.xP)(n,e,e-1,t,o,s,u)})(r),disabled:0===r,style:{padding:"4px 8px",borderRadius:4,border:"none",background:0===r?"#bdc3c7":"#3498db",color:"#fff",fontWeight:600,fontSize:"0.75rem",cursor:0===r?"not-allowed":"pointer",minWidth:"28px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(52, 152, 219, 0.08)",transition:"background 0.2s"},children:"\u2191"}),(0,a.jsx)("button",{onClick:()=>(e=>{e<t.length-1&&(0,g.xP)(n,e,e+1,t,o,s,u)})(r),disabled:r===t.length-1,style:{padding:"4px 8px",borderRadius:4,border:"none",background:r===t.length-1?"#bdc3c7":"#2ecc71",color:"#fff",fontWeight:600,fontSize:"0.75rem",cursor:r===t.length-1?"not-allowed":"pointer",minWidth:"28px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(46, 204, 113, 0.08)",transition:"background 0.2s"},children:"\u2193"})]})})]},r)}))})]}),(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)("button",{onClick:async()=>{localStorage.removeItem("sqlite-db"),o("Databasen er t\xf8mt.");var e;await(e="/sql/sql-wasm.js",new Promise(((t,n)=>{if(window.initSqlJs)return void t();const r=document.createElement("script");r.src=e,r.async=!0,r.onload=t,r.onerror=n,document.body.appendChild(r)})));const t=new((await window.initSqlJs({locateFile:()=>"/sql/sql-wasm.wasm"})).Database);t.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);"),r(t),s([]),i(""),d(null),l(null),c(!1),u(1)},style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#e74c3c",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(231, 76, 60, 0.08)",transition:"background 0.2s"},children:"Clear database"})})]})},p=e=>{let{message:t,showScanner:n,setShowScanner:r,qrCode:o,setQrCode:s,setSnapshot:i,setImage:d,setMessage:l,snapshot:c,image:g,nextQRNumber:p,handleSave:m,handleSaveFinalTreasure:f,databaseContent:x,db:S,setDb:w,setDatabaseContent:R,setShowScanner:y,setNextQRNumber:E}=e;return(0,a.jsxs)("div",{style:{maxWidth:500,margin:"40px auto",padding:24,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,a.jsx)("h1",{style:{textAlign:"center"},children:"Scan QR Code and Take Snapshot"}),(0,a.jsx)("p",{children:t}),(0,a.jsx)(u,{showScanner:n,setShowScanner:r,qrCode:o,setQrCode:s,setSnapshot:i,setImage:d,setMessage:l}),(0,a.jsx)(h,{snapshot:c,setSnapshot:i,image:g,setImage:d,qrCode:o,nextQRNumber:p,handleSave:m,handleSaveFinalTreasure:f}),(0,a.jsx)(b,{databaseContent:x,db:S,setDb:w,setMessage:l,setDatabaseContent:R,setQrCode:s,setImage:d,setSnapshot:i,setShowScanner:y,setNextQRNumber:E})]})};const m=()=>{const[e,t]=(0,s.useState)(null),[n,r]=(0,s.useState)("Vent, laster inn..."),[o,i]=(0,s.useState)(""),[d,l]=(0,s.useState)(null),[c,u]=(0,s.useState)([]),[h,b]=(0,s.useState)(!1),[m,f]=(0,s.useState)(null),[x,S]=(0,s.useState)(1),w=async()=>{const e={locateFile:()=>"/sql/sql-wasm.wasm"};try{await(n="/sql/sql-wasm.js",new Promise(((e,t)=>{if(window.initSqlJs)return void e();const r=document.createElement("script");r.src=n,r.async=!0,r.onload=e,r.onerror=t,document.body.appendChild(r)})));const a=await window.initSqlJs(e);let o;console.log("sql.js initialized \ud83c\udf89");const s=localStorage.getItem("sqlite-db");if(s){const e=new Uint8Array(atob(s).split("").map((e=>e.charCodeAt(0))));o=new a.Database(e),console.log("Database loaded from localStorage")}else o=new a.Database,o.run("\n          CREATE TABLE IF NOT EXISTS steg (\n            qrkode TEXT PRIMARY KEY,\n            bilde_base64 TEXT\n          );\n        ");t(o),r("Start scanning QR codes and taking snapshots!"),(0,g.Wp)(o,u,S)}catch(a){console.error("Error initializing sql.js:",a),r("Could not load the database.")}var n};return(0,s.useEffect)((()=>{w()}),[]),(0,a.jsx)(p,{message:n,showScanner:h,setShowScanner:b,qrCode:o,setQrCode:i,setSnapshot:f,setImage:l,setMessage:r,snapshot:m,image:d,nextQRNumber:x,handleSave:()=>{if(!o||!d||!e)return void r("Please scan a QR code and take a snapshot first!");const t=e.prepare("SELECT COUNT(*) as count FROM steg WHERE qrkode = ?");t.bind([o]);let n=!1;if(t.step()){n=t.getAsObject().count>0}t.free(),n?(e.run("UPDATE steg SET bilde_base64 = ? WHERE qrkode = ?",[d,o]),r(`QR-kode ${o} oppdatert med nytt bilde!`)):(e.run("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)",[o,d]),r(`QR-kode ${o} og bilde lagret!`)),(0,g.UD)(e),(0,g.Wp)(e,u,S),i(""),l(null),f(null),b(!1)},handleSaveFinalTreasure:()=>{if(!d||!e)return void r("Please take a snapshot of the treasure location first!");const t=(()=>{if(0===c.length)return 1;const e=c.map((e=>{let[t]=e;return parseInt(t)})).filter((e=>!isNaN(e)));return e.length>0?Math.max(...e)+1:1})();try{e.run("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)",[t.toString(),d]),r(`Final treasure location saved as entry ${t}! This is where the treasure is hidden (no QR code needed).`),(0,g.UD)(e),(0,g.Wp)(e,u,S),f(null),l(null),b(!1)}catch(n){console.error("Error saving final treasure:",n),r("Error saving final treasure location.")}},databaseContent:c,db:e,setDb:t,setDatabaseContent:u,setNextQRNumber:S})},f={sidebar_position:2,title:"Create Treasure Hunt",hide_title:!0},x=void 0,S={},w=[];function R(e){return(0,a.jsx)(m,{})}function y(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(R,{...e})}):R()}},2921:(e,t,n)=>{n.d(t,{J$:()=>a,N7:()=>c,Pr:()=>i,UD:()=>r,Wp:()=>s,hP:()=>d,wU:()=>o,xP:()=>u,zj:()=>l});const r=e=>{const t=e.export(),n=function(e){let t,n=0,r=e.length,a="";for(;n<r;)t=e.subarray(n,Math.min(n+32768,r)),a+=String.fromCharCode.apply(null,t),n+=32768;return btoa(a)}(new Uint8Array(t));localStorage.setItem("sqlite-db",n),console.log("Database saved to localStorage")};const a=(e,t,n)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout((()=>{t&&(console.log("Retrying image load with available database"),a(e,t,n))}),100),null;try{const r=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode = ?");if(r.bind([e.toString()]),r.step()){const t=r.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),n&&n(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),n&&n(null),null}catch(r){return console.error("Error loading image:",r),n&&n("ERROR"),"ERROR"}},o=async(e,t,n,r)=>{try{console.log("Loading database...");const o={locateFile:()=>"/sql/sql-wasm.wasm"};await(a="/sql/sql-wasm.js",new Promise(((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=a,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)})));const s=await window.initSqlJs(o),i=localStorage.getItem("sqlite-db");let d;if(i){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(i).split("").map((e=>e.charCodeAt(0))));d=new s.Database(e)}else console.log("No saved database found, creating new one"),d=new s.Database,d.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);");e(d),((e,t,n,r)=>{try{console.log("Initializing treasure sequence...");const a=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),o=[];for(;a.step();){const e=a.getAsObject();o.push(e.qrkode)}a.free(),console.log("Found treasure sequence:",o),t(o),o.length>0?(console.log("Loading first image for step 1"),r(1,e)):(console.log("No treasures found in database"),n("NO_DATA"))}catch(a){console.error("Error initializing sequence:",a),n("ERROR")}})(d,n,t,r)}catch(o){console.error("Error loading database:",o),t("ERROR")}var a},s=(e,t,n)=>{const r=e.exec("SELECT * FROM steg"),a=r[0]?r[0].values:[];if(t(a),0===a.length)n(1);else{const e=a.map((e=>{let[t]=e;return parseInt(t)})).filter((e=>!isNaN(e)));n(e.length>0?Math.max(...e)+1:1)}},i=(e,t,n)=>"random"===e?t:n,d=(e,t,n,r,o,s,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:h,setGameComplete:g,setCurrentImage:b}=l,p=i(n,r,o),m=p.slice(0,-1),f=m.includes(e),x=s.includes(e);if(f&&!x){u((t=>[...t,e]));const t=m.filter((t=>!s.includes(t)&&t!==e));if(0===t.length){const t=o[o.length-1];a(t,d,b),h(p.length),g(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`)}else{const n=t[0];a(n,d,b),h(s.length+1),1===t.length?c(`${e} found! Find the last location (QR ${n})`):c(`${e} found! Find any of the ${t.length} remaining locations`)}}else x?c(`Already found: QR ${e} was already scanned`):o.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")},l=(e,t,n,r)=>{const{setGameStarted:o,setCurrentStep:s,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=r;if(0!==t.length)if(o(!0),s(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(t.slice(0,-1));c([...e,t[t.length-1]]),a(e[0],n,u)}else c(t),a(t[0],n,u)},c=(e,t,n,a,o)=>{try{const i=e.prepare("DELETE FROM steg WHERE qrkode = ?");i.bind([t]),i.step(),i.free(),r(e),s(e,a,o),n(`Item with QR code ${t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),n("Error deleting item from database.")}},u=(e,t,n,a,o,i,d)=>{try{if(t===n||t<0||n<0||t>=a.length||n>=a.length)return;const l=[...a],[c]=l.splice(t,1);l.splice(n,0,c),e.run("DELETE FROM steg"),l.forEach((t=>{let[n,r]=t;const a=e.prepare("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)");a.bind([n,r]),a.step(),a.free()})),r(e),s(e,i,d);const u=t<n?"down":"up";o(`Moved item with QR code ${c[0]} ${u} to position ${n+1}`)}catch(l){console.error("Error reordering database items:",l),o("Error reordering items in database.")}}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var r=n(6540);const a={},o=r.createContext(a);function s(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);