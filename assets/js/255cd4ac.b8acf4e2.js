"use strict";(self.webpackChunkerlendthune_com=self.webpackChunkerlendthune_com||[]).push([[1572],{709:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>g,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"treasurehunter/treasure-hunt","title":"Treasure Hunt","description":"Open the standalone QR scanner page do perform the treasure hunt.","source":"@site/docs/treasurehunter/treasure-hunt.mdx","sourceDirName":"treasurehunter","slug":"/treasurehunter/treasure-hunt","permalink":"/docs/treasurehunter/treasure-hunt","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Treasure Hunt","hide_title":true},"sidebar":"productsSidebar","previous":{"title":"Create Treasure Hunt","permalink":"/docs/treasurehunter/create-treasure-hunt"},"next":{"title":"Garmin wizard","permalink":"/docs/category/garmin-wizard"}}');var o=r(4848),a=r(8453),s=r(129);const i={sidebar_position:3,title:"Treasure Hunt",hide_title:!0},d=void 0,l={},c=[];function u(e){const t={a:"a",p:"p",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Open the ",(0,o.jsx)(t.a,{href:"/qr-scanner",children:"standalone QR scanner page"})," do perform the treasure hunt."]}),"\n",(0,o.jsx)(t.p,{children:"You can also test it below:"}),"\n",(0,o.jsx)(s.A,{showScannedCode:!0})]})}function g(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},2921:(e,t,r)=>{r.d(t,{J$:()=>o,N7:()=>c,Pr:()=>i,UD:()=>n,Wp:()=>s,hP:()=>d,wU:()=>a,xP:()=>u,zj:()=>l});const n=e=>{const t=e.export(),r=function(e){let t,r=0,n=e.length,o="";for(;r<n;)t=e.subarray(r,Math.min(r+32768,n)),o+=String.fromCharCode.apply(null,t),r+=32768;return btoa(o)}(new Uint8Array(t));localStorage.setItem("sqlite-db",r),console.log("Database saved to localStorage")};const o=(e,t,r)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout((()=>{t&&(console.log("Retrying image load with available database"),o(e,t,r))}),100),null;try{const n=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode = ?");if(n.bind([e.toString()]),n.step()){const t=n.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),r&&r(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),r&&r(null),null}catch(n){return console.error("Error loading image:",n),r&&r("ERROR"),"ERROR"}},a=async(e,t,r,n)=>{try{console.log("Loading database...");const a={locateFile:()=>"/sql/sql-wasm.wasm"};await(o="/sql/sql-wasm.js",new Promise(((e,t)=>{if(window.initSqlJs)return void e();const r=document.createElement("script");r.src=o,r.async=!0,r.onload=e,r.onerror=t,document.body.appendChild(r)})));const s=await window.initSqlJs(a),i=localStorage.getItem("sqlite-db");let d;if(i){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(i).split("").map((e=>e.charCodeAt(0))));d=new s.Database(e)}else console.log("No saved database found, creating new one"),d=new s.Database,d.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);");e(d),((e,t,r,n)=>{try{console.log("Initializing treasure sequence...");const o=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),a=[];for(;o.step();){const e=o.getAsObject();a.push(e.qrkode)}o.free(),console.log("Found treasure sequence:",a),t(a),a.length>0?(console.log("Loading first image for step 1"),n(1,e)):(console.log("No treasures found in database"),r("NO_DATA"))}catch(o){console.error("Error initializing sequence:",o),r("ERROR")}})(d,r,t,n)}catch(a){console.error("Error loading database:",a),t("ERROR")}var o},s=(e,t,r)=>{const n=e.exec("SELECT * FROM steg"),o=n[0]?n[0].values:[];if(t(o),0===o.length)r(1);else{const e=o.map((e=>{let[t]=e;return parseInt(t)})).filter((e=>!isNaN(e)));r(e.length>0?Math.max(...e)+1:1)}},i=(e,t,r)=>"random"===e?t:r,d=(e,t,r,n,a,s,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:g,setGameComplete:h,setCurrentImage:m}=l,p=i(r,n,a),f=((e,t,r,n)=>{const o=i(e,t,r);return 0===o.length||n>o.length?null:o[n-1]})(r,n,a,t);if(e===f&&!s.includes(e))if(c(e),u((t=>[...t,e])),t>=p.length-1){const e=a[a.length-1];o(e,d,m),g(p.length),h(!0)}else{const e=t+1,r=p[e-1];o(r,d,m),g(e)}},l=(e,t,r,n)=>{const{setGameStarted:a,setCurrentStep:s,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=n;if(0!==t.length)if(a(!0),s(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let r=t.length-1;r>0;r--){const e=Math.floor(Math.random()*(r+1));[t[r],t[e]]=[t[e],t[r]]}return t})(t.slice(0,-1));c([...e,t[t.length-1]]),o(e[0],r,u)}else c(t),o(t[0],r,u)},c=(e,t,r,o,a)=>{try{const i=e.prepare("DELETE FROM steg WHERE qrkode = ?");i.bind([t]),i.step(),i.free(),n(e),s(e,o,a),r(`Item with QR code ${t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),r("Error deleting item from database.")}},u=(e,t,r,o,a,i,d)=>{try{if(t===r||t<0||r<0||t>=o.length||r>=o.length)return;const l=[...o],[c]=l.splice(t,1);l.splice(r,0,c),e.run("DELETE FROM steg"),l.forEach((t=>{let[r,n]=t;const o=e.prepare("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)");o.bind([r,n]),o.step(),o.free()})),n(e),s(e,i,d);const u=t<r?"down":"up";a(`Moved item with QR code ${c[0]} ${u} to position ${r+1}`)}catch(l){console.error("Error reordering database items:",l),a("Error reordering items in database.")}}},129:(e,t,r)=>{r.d(t,{A:()=>h});var n=r(6540),o=r(4848);const a=e=>{let{huntMode:t,setHuntMode:r,onStartGame:n,treasureCount:a}=e;return(0,o.jsxs)("div",{style:{marginBottom:20,padding:20,background:"#f8f9fa",borderRadius:8},children:[(0,o.jsx)("h3",{style:{textAlign:"center",marginBottom:15},children:"Choose Hunt Mode"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[(0,o.jsxs)("div",{style:{padding:15,border:"sequential"===t?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"sequential"===t?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>r("sequential"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"sequential"===t?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Sequential Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Follow the hunt in order (1, 2, 3...). Perfect for guided tours or specific paths."})]}),(0,o.jsxs)("div",{style:{padding:15,border:"random"===t?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"random"===t?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>r("random"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"random"===t?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Random Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Find locations in any order. Great for exploration and flexibility."})]})]}),(0,o.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,o.jsxs)("button",{onClick:n,style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#007bff",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:"1em",boxShadow:"0 2px 8px rgba(0, 123, 255, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="#0056b3",onMouseOut:e=>e.target.style.background="#007bff",children:["Start ","sequential"===t?"Sequential":"Random"," Hunt \ud83d\uddfa\ufe0f"]})}),(0,o.jsxs)("div",{style:{textAlign:"center",marginTop:15,fontSize:"0.8em",color:"#666"},children:["Found ",a," locations in database",a>1&&(0,o.jsxs)("span",{children:[" \u2022 ",a-1," QR codes + 1 treasure location"]})]})]})},s=e=>{let{gameStarted:t,gameComplete:r,scannedCodes:n,treasureSequence:a,huntMode:s,getCurrentSequence:i}=e;return t?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:10},children:r?`Treasure Hunt Complete! Found ${n.length} locations + treasure`:`Progress: ${n.length} of ${a.length-1} locations found`}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:5},children:i().map(((e,t)=>(0,o.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:t<n.length?"#4caf50":t!==n.length||r?t===i().length-1&&r?"#ffd700":"#e0e0e0":"#2196f3"},title:t===i().length-1?"Treasure location":`Location ${t+1}`},t)))}),r&&(0,o.jsx)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:"\ud83c\udfc6 = Treasure location (no QR code here)"}),(0,o.jsxs)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:["Mode: ","sequential"===s?"Sequential":"Random"," Hunt"]})]}):null},i=e=>{let{currentImage:t,currentStep:r,gameComplete:n,scannedCodes:a,onStartNewHunt:s}=e;return"NO_DATA"===t?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#fff3cd",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"No Treasure Hunt Data Found"}),(0,o.jsx)("p",{children:"Please use the Treasure Hunt Maker to create some QR codes and images first."}),(0,o.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:"Go to the maker page, scan QR codes, take snapshots, and save them to the database."})]}):"ERROR"===t?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#f8d7da",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"Error Loading Treasure Hunt"}),(0,o.jsx)("p",{children:"There was an error loading the treasure hunt data."}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#dc3545",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:10},children:"Retry"})]}):t&&0!==t.length?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("h3",{style:{marginBottom:10},children:n?"\ud83c\udf89 Treasure Found! \ud83c\udf89":0===a.length?"Find this location to start!":`Find location ${r}`}),(0,o.jsx)("img",{src:t,alt:`Location ${r}`,style:{maxWidth:"100%",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,o.jsx)("div",{style:{marginTop:10,fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:n?"\ud83c\udfc6 This is where the treasure is hidden! No QR code to scan here.":"When you find this location, scan the QR code there to proceed."}),n&&(0,o.jsx)("button",{onClick:s,style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:15,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.3)"},children:"Start New Hunt"})]}):(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:"#e3f2fd",borderRadius:8,textAlign:"center"},children:(0,o.jsx)("strong",{children:"Loading treasure hunt..."})})};var d=r(6624),l=r.n(d);const c=e=>{let{onQRCodeScanned:t,width:r=320,height:a=240,style:s={}}=e;const i=(0,n.useRef)(null),d=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let e,r=null,n=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!n)return void o.getTracks().forEach((e=>e.stop()));if(r=o,i.current){i.current.srcObject=o,i.current.setAttribute("playsinline",!0),i.current.setAttribute("muted",!0);const r=async()=>{try{if(await i.current.play(),n&&i.current&&!i.current.paused){const r=()=>{if(n&&i.current&&!i.current.paused){if(i.current&&d.current){const e=d.current.getContext("2d");e.drawImage(i.current,0,0,d.current.width,d.current.height);const r=e.getImageData(0,0,d.current.width,d.current.height),n=l()(r.data,r.width,r.height);n&&n.data&&t(n.data)}n&&(e=setTimeout((()=>{n&&i.current&&!i.current.paused&&r()}),200))}};r()}}catch(r){"AbortError"!==r.name&&console.warn("Video play error:",r)}};i.current.readyState>=1?r():i.current.addEventListener("loadedmetadata",r,{once:!0})}}catch(o){console.error("Error accessing camera:",o)}})(),()=>{if(n=!1,e&&clearTimeout(e),i.current&&(i.current.pause(),i.current.srcObject)){i.current.srcObject.getTracks().forEach((e=>e.stop())),i.current.srcObject=null}r&&r.getTracks().forEach((e=>e.stop()))}}),[t]),(0,o.jsxs)("div",{style:s,children:[(0,o.jsx)("video",{ref:i,style:{width:r,height:a,...s.video}}),(0,o.jsx)("canvas",{ref:d,width:r,height:a,style:{display:"none"}})]})},u=e=>{let{gameComplete:t,lastScannedCode:r,handleQRCodeScanned:n,scannedCodes:a,currentStep:s,showScannedCode:i}=e;return t?null:(0,o.jsxs)(o.Fragment,{children:[r&&(0,o.jsxs)("div",{style:{marginBottom:20,padding:10,background:"#e8f5e8",borderRadius:8,textAlign:"center"},children:["\u2705 Found location ",r,"!"]}),(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("h4",{style:{marginBottom:10},children:"QR Code Scanner"}),(0,o.jsx)(c,{onQRCodeScanned:n,width:320,height:240}),i&&r&&(0,o.jsxs)("div",{style:{marginTop:5,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["Last scanned: ",r]})]})]})};var g=r(2921);const h=e=>{let{showScannedCode:t=!1}=e;const[r,d]=(0,n.useState)(null),[l,c]=(0,n.useState)(1),[h,m]=(0,n.useState)(null),[p,f]=(0,n.useState)([]),[b,x]=(0,n.useState)([]),[S,y]=(0,n.useState)(!1),[C,R]=(0,n.useState)(""),[j,v]=(0,n.useState)("sequential"),[w,E]=(0,n.useState)(!1),[T,k]=(0,n.useState)([]);(0,n.useEffect)((()=>{(0,g.wU)(d,m,x,((e,t)=>{(0,g.J$)(e,t,m)}))}),[]);return(0,o.jsxs)("div",{style:{maxWidth:500,margin:"0px auto",padding:20,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,o.jsx)("h2",{style:{textAlign:"center",marginBottom:20},children:"Treasure Hunt"}),!w&&b.length>0&&"NO_DATA"!==h&&"ERROR"!==h&&(0,o.jsx)(a,{huntMode:j,setHuntMode:v,onStartGame:()=>{const e={setGameStarted:E,setCurrentStep:c,setScannedCodes:f,setLastScannedCode:R,setGameComplete:y,setShuffledSequence:k,setCurrentImage:m};(0,g.zj)(j,b,r,e)},treasureCount:b.length}),(0,o.jsx)(s,{gameStarted:w,gameComplete:S,scannedCodes:p,treasureSequence:b,huntMode:j,getCurrentSequence:()=>(0,g.Pr)(j,T,b)}),w&&(0,o.jsx)(i,{currentImage:h,currentStep:l,gameComplete:S,scannedCodes:p,onStartNewHunt:()=>{window.location.reload()}}),w&&(0,o.jsx)(u,{gameComplete:S,lastScannedCode:C,handleQRCodeScanned:e=>{const t={setLastScannedCode:R,setScannedCodes:f,setCurrentStep:c,setGameComplete:y,setCurrentImage:m};(0,g.hP)(e,l,j,T,b,p,r,t)},scannedCodes:p,currentStep:l,showScannedCode:t})]})}},8453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>i});var n=r(6540);const o={},a=n.createContext(o);function s(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);